#trying to invoke powershell crap in ansible so that we can do all kinds of awesome things 
# We enjoy doing kinda awesome things like voquein
---
- name: invoke SQL powershell
  hosts: all
  connection: winrm
  tasks:
    - name: Create user
      win_shell: |
        $data = Invoke-Sqlcmd -Query "SELECT * FROM [Challenge].[dbo].[user]" -ServerInstance "srv-winess19"
        foreach($employee in $data)
        {
        write-output $employee
        New-ADUser -Name $employee.name -GivenName $employee.firstname -Surname $employee.lastname -SamAccountName $employee.name -Path $employee.path -Enabled $false
        } 
        

