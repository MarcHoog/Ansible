#trying to invoke powershell crap in ansible so that we can do all kinds of awesome things 
# We enjoy doing kinda awesome things like voquein
---
- name: invoke SQL powershell
  hosts: all
  connection: winrm
  tasks:
    - name: Create user
      win_shell: |
        $employee = Invoke-Sqlcmd -Query "SELECT TOP (1) [name],[firstname],[lastname],[company],[state],[path],[present] FROM [Challenge].[dbo].[user]" -ServerInstance "srv-winess19"
        write $employee
        New-ADUser -Name $employee.firstname -GivenName $employee.firstname -Surname $employee.lastname -SamAccountName $employee.name -Path $employee.path -Enabled $false

